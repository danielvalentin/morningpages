<?php defined('SYSPATH') or die('No direct script access.'); abstract class mail {		public static function create($type)	{		$mailtemplate = ORM::factory('Mailtemplate')->where('type','=',$type)->find();		if(!$mailtemplate->loaded())		{			throw new Exception("Mailtemplate not found!");		}		$mail = ORM::factory('Mail');		$mail->token = self::create_token();		$mail->subject = $mailtemplate->subject;		$mail->content = $mailtemplate->content;		return $mail;	}		public static function create_token()	{		do		{			$token = sha1(uniqid(Text::random('alnum', 32), TRUE));		}		while(ORM::factory('Mail', array('token' => $token))->loaded());		return $token;	}	}