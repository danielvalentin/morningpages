<?php defined('SYSPATH') or die('No direct script access.');abstract class maintenance {		/**	 * Removes deleted users after 7 days	 */	public static function deletions()	{		$stamp = strtotime('-7 days');		$users = ORM::factory('User')			->where('delete','<',$stamp)			->where('delete','!=',0)			->find_all();		if((bool)$users->count())		{			foreach($users as $user)			{				$user->delete();			}		}	}		/**	 * emails daily reminders	 */	public static function reminders()	{		$maintenance = ORM::factory('Maintenance')->where('name', '=', 'reminders')->find();;		if(!$maintenance->loaded())		{			log::adderror('No maintenance row called reminders found');			return;			//die('Reminders maintenance row not found.');		}		if($maintenance->last >= (time()-(60*60*24)))		{			return;			//die('not time yet.');		}		$users = ORM::factory('User')->where('reminder','=',1)->find_all();		if(!(bool)$users->count())		{			return;			//die('nothing to do');		}				$startofmonth = mktime(0,0,0,date('n'),1,date('Y'));		$daysinmonth = date('t');		foreach($users as $user)		{			$daysthismonth = $user->pages->where('created','>',$startofmonth)->where('type','=','page')->count_all();			$totalwords = $user->all_time_words;			$totalwords = '<strong>'.$totalwords.'</strong>'.' total word'.($totalwords==1?'':'s');			$currentstreak = $user->current_streak.' word'.($user->current_streak==1?'':'s');			$currentstreak = $currentstreak.' day'.($currentstreak==1?'':'s');			$dayswrittenthismonth = '<strong>'.$daysthismonth.'</strong> out of '.$daysinmonth.' days this month';						$mail = mail::create('reminder')				->to($user->email)				->tokenize(array(					'username' => $user->username,					'writeurl' => URL::site('write', true),					'link' => HTML::anchor('write','Itâ€™s time to write your Morning Pages'),					'totalwords' => $totalwords,					'currentstreak' => $currentstreak,					'dayswrittenthismonth' => $dayswrittenthismonth,					'contactlink' => HTML::anchor('suggestions','contact us')				))				->send();		}		$maintenance->last = time();		$maintenance->save();	}	}