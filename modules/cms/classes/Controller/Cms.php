<?php defined('SYSPATH') or die('No direct script access.');class Controller_Cms extends Controller_Template {		public $template = 'Cms/templates/default';	public $css = array();	public $scripts = array();		public function before()	{		if(!user::logged('admin') && $this->request->action() !== 'media')		{			site::redirect();		}		if ($this->request->action() === 'media' || $this->request->action() === 'uploads')		{			// Do not template media files			$this->auto_render = FALSE;		}		else		{			parent::before();			$this->template->controller = str_replace('cms_', '', $this->request->controller());			$this->template->action = $this -> request -> action();			$file = $this->template->controller . '/' . $this->template->action;			$file = str_replace('_','/',$file);			if((file_exists(Kohana::find_file('views', $file))))			{				$this->template->view = View::factory($file);			}					}	}		public function after()	{		if(is_object($this -> template))		{			$this->template->scripts = $this->scripts;			$this->template->css = $this->css;		}		parent::after();	}		public function action_index()	{		$this->template->view = View::factory('Cms/Controlpanel/index');	}		public function action_media()	{		$file = $this->request->param('file');		$ext = pathinfo($file, PATHINFO_EXTENSION);		$file = substr($file, 0, -(strlen($ext) + 1));		if($ext == 'php')		{			include 'modules/cms/media/' . $file . '.' . $ext;		}		else		{			if ($file = Kohana::find_file('media', $file, $ext))			{				//$this->response->check_cache(sha1($this->request->uri()).filemtime($file), $this->request);				$this->response->body(file_get_contents($file));				$this->response->headers('content-type',  File::mime_by_ext($ext));				$this->response->headers('last-modified', date('r', filemtime($file)));			}			else			{				$this->response->status(404);			}		}	}		public function set_view($viewname)	{		$this->template->view = view::factory($viewname);	}		public function bind($key, $val)	{		$this->template->view->$key = $val;	}		public function load_script($script)	{		$this -> scripts[] = $script;	}		public function load_css($file)	{		$this -> css[] = $file;	}}