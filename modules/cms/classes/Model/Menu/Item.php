<?php defined('SYSPATH') or die('No direct script access.');class Model_Menu_Item extends ORM{		protected $_belongs_to = array(		'menu' => array(),		'page' => array(),		'content' => array()	);		protected $_sorting = array('order' => 'ASC');		public function get_linktext()	{		if(empty($this->linktext))		{			if(empty($this->titletext))			{				return $this->get_url();			}			return $this->titletext;		}		return $this -> linktext;	}		public function get_url()	{		switch($this->type)		{			case 'external':				return $this->url;				break;			case 'product':				$prod = ORM::factory('product', $this->content_id);				return $prod->url();				break;			case 'brand':				$brand = ORM::factory('brand', $this->content_id);				return $brand->url();				break;			case 'productcategory':				$productcategory = ORM::factory('productcategory', $this->content_id);				return $productcategory->url();				break;			default:				return url::site($this->content->get_url());				break;		}		return url::site($this -> url, true);	}		public function get_titletext()	{		if(empty($this->titletext))		{			if(empty($this->linktext))			{				return $this->get_url();			}			return $this->linktext;		}		return $this -> titletext;	}		public function get_classes()	{		return $this -> classes;	}		public function get_link($class = '')	{		return '<a href="' . $this -> get_url() . '" class="' . $class . '" title="' . $this -> get_titletext() . '">' . $this -> get_linktext() . '</a>';	}		public function get_type()	{		switch($this->type)		{			case 'external':				return 'Ekstern';				break;			case 'productcategory':				return 'Kategori';				break;			case 'brand':				return 'Brand';				break;			case 'product':				return 'Produkt';				break;			default:				return $this->content->contenttype->display;				break;		}	}		public function delete()	{		$kids = ORM::factory('menu_item')->where('parent', '=',$this->id)->find_all();		if((bool)$kids->count()) foreach($kids as $kid)		{			$kid->delete();		}		return parent::delete();	}		public function info()	{		$kids = array();		$children = ORM::factory('Menu_Item')			->where('parent','=',$this->id)			->find_all();		if((bool)$children->count())		{			foreach($children as $child)			{				$kids[] = $child->info();			}		}		return array(			'id' => $this->id,			'content' => array(				'id' => $this->content_id,				'title' => ($this->content_id==0?'':$this->content->title)			),			'parent' => $this->parent,			'type' => $this->type,			'linktext' => (empty($this->linktext)?$this->content->title:$this->linktext),			'titletext' => $this->titletext,			'classes' => $this->classes,			'order' => $this->order,			'url' => ($this->content_id==0?$this->url:$this->content->guid),			'children' => $kids		);	}	}