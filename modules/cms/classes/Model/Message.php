<?php defined('SYSPATH') or die('No direct script access.');class Model_Message extends ORM {		protected $_belongs_to = array(		'user' => array(),		'role' => array()	);		public function set_read()	{		$this->read = 1;		$this->save();	}		public function info()	{		$sender = array(			'type' => $this->type,			'name' => __('Site'),			'user_id' => 0		);		if($this->type == 'user')		{			$user = ORM::factory('User', $this->from);			$sender['name'] = $user->name;			$sender['id'] = $user->id;		}				$recipient = array();		if($this->user_id != 0)		{			$recipient['type'] = 'user';			$recipient['id'] = $this->user_id;			$recipient['name'] = $this->user->name;		}		elseif($this->role_id != 0)		{			$recipient['type'] = 'role';			$recipient['id'] = $this->role_id;			$recipient['name'] = $this->role->name;		}				$hasreply = false;		$reply = ORM::factory('Message')			->where('parent','=',$this->id)			->find();		if($reply->loaded())		{			$hasreply = true;		}				return array(			'id' => $this->id,			'user_id' => $this->user_id,			'role_id' => $this->role_id,			'hasreply' => $hasreply,			'type' => $this->type,			'subject' => $this->subject,			'message' => $this->message,			'created' => $this->created,			'nicedate' => date('d/m/Y H:i', $this->created),			'sender' => $sender,			'recipient' => $recipient,			'read' => $this->read,		);	}	}